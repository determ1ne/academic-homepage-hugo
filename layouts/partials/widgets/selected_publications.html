{{ $context := .context }}
{{ $selected := where (where $context.Site.RegularPages "Type" "publications") "Params.selected" true }}
{{ $selected = sort $selected "Date" "desc" }}

{{ if gt (len $selected) 0 }}
<div class="my-3 p-0 bg-white shadow-sm rounded-xl">
    <h6 class="border-bottom border-gray p-3 mb-0">
        <i class="fas fa-star"></i> Selected Publications 
        <a href="{{ "publications" | relURL }}">(view all <i class="fas fa-angle-double-right"></i>)</a>
    </h6>
    
    {{ range $index, $pub := $selected }}
    <div class="d-none d-md-block">
        <div class="row no-gutters border-bottom border-gray{{ if eq $index (sub (len $selected) 1) }}{{ else }}{{ end }}">
            <div class="col-md-3 col-xl-2 mb-md-0 p-md-3">
                {{ if $pub.Params.cover }}
                <img src="{{ $pub.Params.cover | relURL }}" alt="{{ $pub.Title }}" class="w-100 rounded-sm">
                {{ else }}
                <div class="bubble-visual-hash w-100 rounded-sm" data-hash="{{ $pub.File.UniqueID }}" style="height: 120px; background-color: #f8f9fa;"></div>
                {{ end }}
            </div>
            <div class="col-md-9 col-xl-10 p-3 pl-md-0">
                <h5 class="mt-0 mb-1 font-weight-normal">{{ $pub.Title }}</h5>
                <p class="mt-0 mb-0 small">
                    {{ range $i, $author := $pub.Params.authors }}
                        {{ if gt $i 0 }}, {{ end }}
                        {{ if or (strings.HasSuffix $author "*") (strings.HasSuffix $author "#") }}
                            <span class="text-body"><strong>{{ $author }}</strong></span>
                        {{ else }}
                            {{ $authorName := $author }}
                            {{ if strings.Contains $author "(" }}
                                {{ $authorName = index (split $author "(") 0 | strings.TrimSuffix " " }}
                            {{ end }}
                            <a class="text-body" target="_blank" href="https://www.google.com/?q={{ $authorName }}">{{ $author }}</a>
                        {{ end }}
                    {{ end }}
                </p>
                <p class="mt-0 mb-0 small">
                    <i>{{ $pub.Params.pub }}</i> {{ $pub.Params.pub_date }}
                    {{ if $pub.Params.pub_last }}{{ $pub.Params.pub_last | safeHTML }}{{ end }}
                    {{ if $pub.Params.semantic_scholar_id }}<span data-semantic-scholar-id="{{ $pub.Params.semantic_scholar_id }}"></span>{{ end }}
                </p>
                {{ if $pub.Params.abstract }}
                <p class="mt-0 mb-0 small text-muted">{{ $pub.Params.abstract | markdownify }}</p>
                {{ end }}
                
                {{ if $pub.Params.links }}
                <p class="small pb-0 mb-0 lh-125 text-muted abstract-links">
                    {{ range $name, $url := $pub.Params.links }}
                        <a target="_blank" href="{{ $url }}">[{{ $name }}]</a>
                    {{ end }}
                </p>
                {{ end }}
            </div>
        </div>
    </div>

    <div class="row no-gutters d-md-none border-bottom border-gray{{ if eq $index (sub (len $selected) 1) }}{{ else }}{{ end }}" {{ if $pub.Params.cover }}data-src="{{ $pub.Params.cover | relURL }}"{{ end }}>
        <div class="w-100" style="background-color: rgba(255,255,255,0.9);">
            <div class="d-flex align-items-start flex-column py-3 px-4">
                <div class="mb-auto"></div>
                <div>
                    <h5 class="mt-0 mb-1 font-weight-normal">{{ $pub.Title }}</h5>
                    <p class="mt-0 mb-0 small">
                        {{ range $i, $author := $pub.Params.authors }}
                            {{ if gt $i 0 }}, {{ end }}
                            {{ if or (strings.HasSuffix $author "*") (strings.HasSuffix $author "#") }}
                                <span class="text-body"><strong>{{ $author }}</strong></span>
                            {{ else }}
                                {{ $authorName := $author }}
                                {{ if strings.Contains $author "(" }}
                                    {{ $authorName = index (split $author "(") 0 | strings.TrimSuffix " " }}
                                {{ end }}
                                <a class="text-body" target="_blank" href="https://www.google.com/?q={{ $authorName }}">{{ $author }}</a>
                            {{ end }}
                        {{ end }}
                    </p>
                    <p class="mt-0 mb-0 small">
                        <i>{{ $pub.Params.pub }}</i> {{ $pub.Params.pub_date }}
                        {{ if $pub.Params.pub_last }}{{ $pub.Params.pub_last | safeHTML }}{{ end }}
                        {{ if $pub.Params.semantic_scholar_id }}<span data-semantic-scholar-id="{{ $pub.Params.semantic_scholar_id }}"></span>{{ end }}
                    </p>
                    {{ if $pub.Params.abstract }}
                    <p class="mt-0 mb-0 small text-muted">{{ $pub.Params.abstract | markdownify }}</p>
                    {{ end }}
                    
                    {{ if $pub.Params.links }}
                    <p class="small pb-0 mb-0 lh-125 text-muted abstract-links">
                        {{ range $name, $url := $pub.Params.links }}
                            <a target="_blank" href="{{ $url }}">[{{ $name }}]</a>
                        {{ end }}
                    </p>
                    {{ end }}
                </div>
            </div>
        </div>
    </div>
    {{ end }}
    
    <h6 class="d-block p-3 mt-0 text-right">
        <a href="{{ "publications" | relURL }}">All publications <i class="fas fa-angle-double-right"></i></a>
    </h6>
</div>
{{ end }}