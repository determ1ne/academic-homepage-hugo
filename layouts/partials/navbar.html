<nav class="navbar navbar-expand-sm navbar-dark bg-dark fixed-top mb-5 shadow-sm">
    <div class="{{ if .Params.container_class }}{{ .Params.container_class }}{{ else }}container-lg{{ end }}">
        {{ $lang := .Language.Lang }}
        {{ $profile := index .Site.Data (printf "profile.%s" $lang) }}
        <a class="navbar-brand" href="{{ relLangURL "" }}"><strong>{{ $profile.navbar_name }}</strong></a>
        <button class="navbar-toggler" style="font-size: 1em; padding: 0.5em;" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <i class="fas fa-map"></i> Menu
        </button>

        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ml-auto">
                {{ $lang := .Language.Lang }}
                {{ $navigation := index .Site.Data (printf "navigation.%s" $lang) }}
                {{ range $navigation.pages }}
                {{ $url := cond (eq $lang "en") .url (printf "/%s%s" $lang .url) }}
                <li class="nav-item {{ if eq .name $.Params.navbar_title }}active{{ end }}">
                    <a class="nav-link" href="{{ $url | relURL }}">{{ .name }}</a>
                </li>
                {{ end }}
                
                <!-- Language Switcher -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="languageDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        {{ if eq $lang "en" }}EN{{ else }}中文{{ end }}
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="languageDropdown">
                        {{ $currentURL := .RelPermalink }}
                        {{ range $.Site.Languages }}
                        {{ $targetLang := .Lang }}
                        {{ if ne $targetLang $lang }}
                        {{ $cleanURL := replace $currentURL (printf "/%s" $lang) "" }}
                        {{ $targetURL := cond (eq $targetLang "en") $cleanURL (printf "/%s%s" $targetLang $cleanURL) }}
                        <a class="dropdown-item" href="{{ $targetURL }}">
                            {{ if eq $targetLang "en" }}English{{ else }}简体中文{{ end }}
                        </a>
                        {{ end }}
                        {{ end }}
                    </div>
                </li>
            </ul>
        </div>
    </div>
</nav>